---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			/* Reading progress bar */
			.reading-progress {
				position: fixed;
				top: 0;
				left: 0;
				width: 0%;
				height: 3px;
				background: linear-gradient(
					90deg,
					var(--accent-blood),
					var(--accent-blood-light)
				);
				z-index: 1000;
				transition: width 0.1s ease;
				box-shadow: 0 0 10px rgba(139, 0, 0, 0.6);
			}

			main {
				width: calc(100% - 2em);
				max-width: 100%;
				margin: 0;
			}

			.hero-image {
				width: 100%;
				max-height: 500px;
				overflow: hidden;
				position: relative;
				background: var(--bg-secondary);
			}

			.hero-image img {
				display: block;
				margin: 0 auto;
				width: 100%;
				height: auto;
				max-height: 500px;
				object-fit: cover;
				filter: brightness(0.85) saturate(0.9);
				box-shadow: none;
				border-radius: 0;
			}

			.hero-image::after {
				content: "";
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				height: 100px;
				background: linear-gradient(
					to top,
					var(--bg-primary),
					transparent
				);
			}

			/* Article container - optimized for readability */
			.article-container {
				max-width: 750px;
				margin: 0 auto;
				padding: 3rem 2rem 5rem;
				position: relative;
			}

			.title-section {
				margin-bottom: 3rem;
				text-align: center;
				padding-bottom: 2rem;
				border-bottom: 2px solid var(--border-color);
			}

			.date {
				color: var(--accent-blood-light);
				font-size: 0.9rem;
				letter-spacing: 0.15em;
				text-transform: uppercase;
				margin-bottom: 1.5rem;
				display: block;
				font-weight: 600;
			}

			.last-updated-on {
				font-style: italic;
				color: var(--text-muted);
				font-size: 0.85rem;
				margin-top: 0.5rem;
			}

			.title-section h1 {
				margin: 0 0 1rem;
				font-size: clamp(2.5rem, 5vw, 3.5rem);
				line-height: 1.2;
				text-shadow: 2px 2px 8px rgba(139, 0, 0, 0.5);
			}

			.title-section hr {
				max-width: 200px;
				margin: 2rem auto 0;
			}

			/* Optimized reading content */
			.prose {
				font-size: 19px;
				line-height: 1.8;
				letter-spacing: 0.01em;
				color: var(--text-primary);
			}

			/* Enhanced readability for prose */
			.prose :global(h2) {
				margin-top: 3rem;
				margin-bottom: 1.5rem;
				font-size: 2rem;
				color: var(--accent-blood-light);
			}

			.prose :global(h3) {
				margin-top: 2.5rem;
				margin-bottom: 1.2rem;
				font-size: 1.6rem;
			}

			.prose :global(h4) {
				margin-top: 2rem;
				margin-bottom: 1rem;
				font-size: 1.3rem;
			}

			.prose :global(p) {
				margin-bottom: 1.8em;
				max-width: var(--reading-width);
			}

			.prose :global(a) {
				color: var(--accent-blood-light);
				text-decoration: underline;
				text-decoration-color: rgba(178, 34, 34, 0.3);
				text-underline-offset: 3px;
				transition: all 0.3s ease;
			}

			.prose :global(a:hover) {
				color: var(--accent-eerie);
				text-decoration-color: var(--accent-eerie);
				text-shadow: 0 0 8px rgba(0, 255, 65, 0.4);
			}

			.prose :global(strong) {
				font-weight: 700;
				color: var(--accent-blood-light);
			}

			.prose :global(blockquote) {
				position: relative;
				margin: 2.5em 0;
			}

			.prose :global(ul),
			.prose :global(ol) {
				margin: 1.5em 0;
				padding-left: 2.5em;
			}

			.prose :global(li) {
				margin-bottom: 0.8em;
			}

			.prose :global(code) {
				font-size: 0.9em;
			}

			.prose :global(pre) {
				margin: 2em 0;
			}

			.prose :global(img) {
				margin: 2.5em auto;
				display: block;
				border-radius: 8px;
			}

			/* Decorative blood stain (subtle) */
			.article-container::before {
				content: "";
				position: absolute;
				top: 10%;
				right: -50px;
				width: 100px;
				height: 100px;
				background: radial-gradient(
					circle,
					rgba(139, 0, 0, 0.03) 0%,
					transparent 70%
				);
				border-radius: 50%;
				pointer-events: none;
			}

			/* Responsive */
			@media (max-width: 768px) {
				.article-container {
					padding: 2rem 1.5rem 4rem;
				}

				.prose {
					font-size: 18px;
				}

				.title-section h1 {
					font-size: 2rem;
				}
			}

			@media (max-width: 480px) {
				.article-container {
					padding: 1.5rem 1rem 3rem;
				}

				.prose {
					font-size: 17px;
					line-height: 1.7;
				}
			}
		</style>

		<script>
			// Reading progress bar
			window.addEventListener("scroll", () => {
				const winScroll =
					document.body.scrollTop ||
					document.documentElement.scrollTop;
				const height =
					document.documentElement.scrollHeight -
					document.documentElement.clientHeight;
				const scrolled = (winScroll / height) * 100;
				const progressBar = document.querySelector(
					".reading-progress",
				) as HTMLElement;
				if (progressBar) {
					progressBar.style.width = scrolled + "%";
				}
			});
		</script>
	</head>

	<body>
		<div class="reading-progress"></div>
		<Header />
		<main>
			<article>
				<div class="hero-image">
					{
						heroImage && (
							<Image
								width={1200}
								height={600}
								src={heroImage}
								alt=""
							/>
						)
					}
				</div>
				<div class="article-container">
					<div class="title-section">
						<div class="date">
							<FormattedDate date={pubDate} />
							{
								updatedDate && (
									<div class="last-updated-on">
										Last updated on{" "}
										<FormattedDate date={updatedDate} />
									</div>
								)
							}
						</div>
						<h1>{title}</h1>
						<hr />
					</div>
					<div class="prose">
						<slot />
					</div>
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
